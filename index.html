<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Narrative Visualization</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script src="https://d3js.org/d3-annotation.v2.min.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <h1>
      UIUC CS 416 - Narrative Visualization - The covid cases and deaths in New
      York
    </h1>
    <h2>By Haiyue Zhang</h2>
    <p>
      My project displays maps of Covid-19 cases and deaths in New York, along
      with a cumulative line chart showing both Covid-19 cases and deaths over
      time. This visualization allows us to observe the trends from 2021 to
      2022.
    </p>
    <div class="buttons">
      <!-- Add a container for the buttons and apply the buttons class here -->
      <button id="button1">2021-01-23 to 2021-05-01</button>
      <button id="button2">2021-05-02 to 2021-08-08</button>
      <button id="button3">2021-08-09 to 2021-11-15</button>
      <button id="button4">2021-11-16 to 2022-02-23</button>
    </div>
    <div id="scene-1" class="scene"></div>
    <div id="scene-2" class="scene"></div>
    <div id="scene-3" class="scene"></div>
    <script>
      let currentScene = 1;
      let scenes = [];
      let data = [];
      let width = 1200;
      let height = 600;
      let margin = { top: 30, right: 30, bottom: 50, left: 100 };
      let xScale = d3.scaleTime().range([margin.left, width - margin.right]); // Adjust the range of xScale
      let yScale = d3.scaleLinear().range([height - margin.bottom, margin.top]);
      let xAxis = d3.axisBottom(xScale).ticks(6);
      let yAxis = d3.axisLeft(yScale);
      let parseDate = d3.timeParse("%Y-%m-%d");
      let line = d3
        .line()
        .x((d) => xScale(d.date))
        .y((d) => yScale(d.cases));

      let tooltip = d3
        .select("body")
        .append("div")
        .style("position", "absolute")
        .style("z-index", "10")
        .style("visibility", "hidden")
        .style("background", "white")
        .style("border", "solid")
        .style("border-width", "1px")
        .style("border-radius", "5px")
        .style("padding", "10px");

      let svg = d3
        .select("#scene-1")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      d3.csv("data/new-york-data.csv", (d) => {
        console.log(d);
        return {
          date: parseDate(d.date),
          state: d.state,
          cases: +d.cases,
          deaths: +d.deaths,
        };
      }).then((d) => {
        data = d;
        setupScenes();
        showScene(1);
      });

      function setupScenes() {
        scenes[1] = svg.append("g");
        scenes[2] = svg.append("g").attr("opacity", 0);
        scenes[3] = svg.append("g").attr("opacity", 0);
        scenes[4] = svg.append("g").attr("opacity", 0);

        // Scene 1
        createScene1();

        // Scene 2
        createScene2();

        // Scene 3
        createScene3();

        // Scene 4
        createScene4();
      }

      function showScene(sceneNum) {
        scenes.forEach((s, i) => {
          s.transition()
            .duration(500)
            .attr("opacity", i === sceneNum ? 1 : 0);
        });
        currentScene = sceneNum;
      }

      function createScene1() {
        // Filter the data for the time period of this scene
        let sceneData = data.filter(
          (d) =>
            d.date >= parseDate("2021-01-23") &&
            d.date <= parseDate("2021-05-01")
        );

        xScale.domain(d3.extent(sceneData, (d) => d.date));
        yScale.domain([0, d3.max(sceneData, (d) => d.cases)]);

        // draw x-axis
        scenes[1]
          .append("g")
          .attr("transform", `translate(0,${height - margin.bottom})`)
          .call(xAxis);

        // Add label for the x-axis
        scenes[1]
          .append("text")
          .attr(
            "transform",
            `translate(${width / 2}, ${height - margin.bottom + 40})`
          )
          .style("text-anchor", "middle")
          .text("Date");

        // draw y-axis
        scenes[1]
          .append("g")
          .attr("transform", `translate(${margin.left},0)`) // Shift the y-axis to the right
          .call(yAxis);

        // Add label for the y-axis
        scenes[1]
          .append("text")
          .attr(
            "transform",
            `translate(${margin.left / 2},${height / 2}) rotate(-90)`
          ) // Adjust the label position
          .style("text-anchor", "middle")
          .text("Cases");

        // draw line
        scenes[1]
          .append("path")
          .datum(sceneData)
          .attr("fill", "none")
          .attr("stroke", "red")
          .attr("stroke-width", 1.5)
          .attr("d", line);

        // draw title
        scenes[1]
          .append("text")
          .attr("x", width / 2)
          .attr("y", margin.top / 2)
          .attr("text-anchor", "middle")
          .style("font-size", "20px")
          .style("text-decoration", "underline")
          .text(
            "New reported cases by day in New York from 2021-01-23 to 2021-05-01"
          );

        // draw dot
        scenes[1]
          .selectAll(".dot")
          .data(sceneData)
          .enter()
          .append("circle")
          .attr("class", "dot")
          .attr("cx", function (d) {
            return xScale(d.date);
          })
          .attr("cy", function (d) {
            return yScale(d.cases);
          })
          .attr("r", 5)
          .on("mouseover", function (event, d) {
            tooltip
              .html(
                `Date: ${d3.timeFormat("%Y-%m-%d")(d.date)}<br/>Cases: ${
                  d.cases
                }`
              )
              .style("visibility", "visible");
          })
          .on("mousemove", function (event) {
            tooltip
              .style("top", d3.pointer(event, this)[1] + 160 + "px")
              .style("left", d3.pointer(event, this)[0] + 80 + "px");
          })
          .on("mouseout", function () {
            tooltip.style("visibility", "hidden");
          });
      }

      function createScene2() {
        let sceneData = data.filter(
          (d) =>
            d.date >= parseDate("2021-05-02") &&
            d.date <= parseDate("2021-08-08")
        );

        xScale.domain(d3.extent(sceneData, (d) => d.date));
        yScale.domain([0, d3.max(sceneData, (d) => d.cases)]);

        // draw x-axis
        scenes[2]
          .append("g")
          .attr("transform", `translate(0,${height - margin.bottom})`)
          .call(xAxis);

        // Add label for the x-axis
        scenes[2]
          .append("text")
          .attr(
            "transform",
            `translate(${width / 2}, ${height - margin.bottom + 40})`
          )
          .style("text-anchor", "middle")
          .text("Date");

        // draw y-axis
        scenes[2]
          .append("g")
          .attr("transform", `translate(${margin.left},0)`)
          .call(yAxis);

        // Add label for the y-axis
        scenes[2]
          .append("text")
          .attr(
            "transform",
            `translate(${margin.left / 2},${height / 2}) rotate(-90)`
          ) // Adjust the label position
          .style("text-anchor", "middle")
          .text("Cases");

        // draw line
        scenes[2]
          .append("path")
          .datum(sceneData)
          .attr("fill", "none")
          .attr("stroke", "red")
          .attr("stroke-width", 1.5)
          .attr("d", line);

        // draw title
        scenes[2]
          .append("text")
          .attr("x", width / 2)
          .attr("y", margin.top / 2)
          .attr("text-anchor", "middle")
          .style("font-size", "20px")
          .style("text-decoration", "underline")
          .text(
            "New reported cases by day in New York from 2021-05-02 to 2021-08-08"
          );

        // draw dot
        scenes[2]
          .selectAll(".dot")
          .data(sceneData)
          .enter()
          .append("circle")
          .attr("class", "dot")
          .attr("cx", function (d) {
            return xScale(d.date);
          })
          .attr("cy", function (d) {
            return yScale(d.cases);
          })
          .attr("r", 5)
          .on("mouseover", function (event, d) {
            tooltip
              .html(
                `Date: ${d3.timeFormat("%Y-%m-%d")(d.date)}<br/>Cases: ${
                  d.cases
                }`
              )
              .style("visibility", "visible");
          })
          .on("mousemove", function (event) {
            tooltip
              .style("top", d3.pointer(event, this)[1] + 160 + "px")
              .style("left", d3.pointer(event, this)[0] + 100 + "px");
          })
          .on("mouseout", function () {
            tooltip.style("visibility", "hidden");
          });
      }

      function createScene3() {
        let sceneData = data.filter(
          (d) =>
            d.date >= parseDate("2021-08-09") &&
            d.date <= parseDate("2021-11-15")
        );

        xScale.domain(d3.extent(sceneData, (d) => d.date));
        yScale.domain([0, d3.max(sceneData, (d) => d.cases)]);

        // draw x-axis
        scenes[3]
          .append("g")
          .attr("transform", `translate(0,${height - margin.bottom})`)
          .call(xAxis);

        // Add label for the x-axis
        scenes[3]
          .append("text")
          .attr(
            "transform",
            `translate(${width / 2}, ${height - margin.bottom + 40})`
          )
          .style("text-anchor", "middle")
          .text("Date");

        // draw y-axis
        scenes[3]
          .append("g")
          .attr("transform", `translate(${margin.left},0)`)
          .call(yAxis);

        // Add label for the y-axis
        scenes[3]
          .append("text")
          .attr(
            "transform",
            `translate(${margin.left / 2},${height / 2}) rotate(-90)`
          ) // Adjust the label position
          .style("text-anchor", "middle")
          .text("Cases");

        // draw line
        scenes[3]
          .append("path")
          .datum(sceneData)
          .attr("fill", "none")
          .attr("stroke", "red")
          .attr("stroke-width", 1.5)
          .attr("d", line);

        // draw title
        scenes[3]
          .append("text")
          .attr("x", width / 2)
          .attr("y", margin.top / 2)
          .attr("text-anchor", "middle")
          .style("font-size", "20px")
          .style("text-decoration", "underline")
          .text(
            "New reported cases by day in New York from 2021-08-09 to 2021-11-15"
          );

        // draw dot
        scenes[3]
          .selectAll(".dot")
          .data(sceneData)
          .enter()
          .append("circle")
          .attr("class", "dot")
          .attr("cx", function (d) {
            return xScale(d.date);
          })
          .attr("cy", function (d) {
            return yScale(d.cases);
          })
          .attr("r", 5)
          .on("mouseover", function (event, d) {
            tooltip
              .html(
                `Date: ${d3.timeFormat("%Y-%m-%d")(d.date)}<br/>Cases: ${
                  d.cases
                }`
              )
              .style("visibility", "visible");
          })
          .on("mousemove", function (event) {
            tooltip
              .style("top", d3.pointer(event, this)[1] + 160 + "px")
              .style("left", d3.pointer(event, this)[0] + 100 + "px");
          })
          .on("mouseout", function () {
            tooltip.style("visibility", "hidden");
          });
      }

      function createScene4() {
        // Filter the data for the time period of this scene
        let sceneData = data.filter(
          (d) =>
            d.date >= parseDate("2021-11-16") &&
            d.date <= parseDate("2022-02-23")
        );

        xScale.domain(d3.extent(sceneData, (d) => d.date));
        yScale.domain([0, d3.max(sceneData, (d) => d.cases)]);

        // draw x-axis
        scenes[4]
          .append("g")
          .attr("transform", `translate(0,${height - margin.bottom})`)
          .call(xAxis);

        // Add label for the x-axis
        scenes[4]
          .append("text")
          .attr(
            "transform",
            `translate(${width / 2}, ${height - margin.bottom + 40})`
          )
          .style("text-anchor", "middle")
          .text("Date");

        // draw y-axis
        scenes[4]
          .append("g")
          .attr("transform", `translate(${margin.left},0)`)
          .call(yAxis);

        // Add label for the y-axis
        scenes[4]
          .append("text")
          .attr(
            "transform",
            `translate(${margin.left / 2},${height / 2}) rotate(-90)`
          ) // Adjust the label position
          .style("text-anchor", "middle")
          .text("Cases");

        // draw line
        scenes[4]
          .append("path")
          .datum(sceneData)
          .attr("fill", "none")
          .attr("stroke", "red")
          .attr("stroke-width", 1.5)
          .attr("d", line);

        // draw title
        scenes[4]
          .append("text")
          .attr("x", width / 2)
          .attr("y", margin.top / 2)
          .attr("text-anchor", "middle")
          .style("font-size", "20px")
          .style("text-decoration", "underline")
          .text(
            "New reported cases by day in New York from 2021-11-16 to 2022-02-23"
          );

        // draw dot
        scenes[4]
          .selectAll(".dot")
          .data(sceneData)
          .enter()
          .append("circle")
          .attr("class", "dot")
          .attr("cx", function (d) {
            return xScale(d.date);
          })
          .attr("cy", function (d) {
            return yScale(d.cases);
          })
          .attr("r", 5)
          .on("mouseover", function (event, d) {
            tooltip
              .html(
                `Date: ${d3.timeFormat("%Y-%m-%d")(d.date)}<br/>Cases: ${
                  d.cases
                }`
              )
              .style("visibility", "visible");
          })
          .on("mousemove", function (event) {
            tooltip
              .style("top", d3.pointer(event, this)[1] + 160 + "px")
              .style("left", d3.pointer(event, this)[0] + 100 + "px");
          })
          .on("mouseout", function () {
            tooltip.style("visibility", "hidden");
          });
      }

      // Add an event listener to the buttons
      d3.select("#button1").on("click", function () {
        showScene(1);
      });

      d3.select("#button2").on("click", function () {
        showScene(2);
      });

      d3.select("#button3").on("click", function () {
        showScene(3);
      });

      d3.select("#button4").on("click", function () {
        showScene(4);
      });
    </script>
  </body>
</html>
